
function Butterfly() {
  THREE.Group.call(this);
  this.body = new ButterflyBody();
  this.wingsL = new ButterflyWings();
  this.wingsR = new ButterflyWings(true);
  this.tentacleL = new ButterflyTentacle();
  this.tentacleR = new ButterflyTentacle(true);

  var doc = new THREE.Group();
  doc.add(this.body, this.wingsL, this.wingsR, this.tentacleL, this.tentacleR);
  doc.rotation.set(-Math.PI/2, -Math.PI/2, 0, 'ZYX');

  this.add(doc);
}

Butterfly.prototype = Object.create(THREE.Group.prototype);
Butterfly.prototype.constructor = Butterfly;

Butterfly.prototype.fly = function() {
  this.wingsL.rotation.y = Math.sin(this.phase * 0.5) * 0.8;
  this.wingsR.rotation.y = -Math.sin(this.phase * 0.5) * 0.8;
}

function ButterflyBody() {
  var positions = [
    0,6.5,0.4,-1.6,5.6,0.4,0,2,0.4,0,6.5,0.4,0,2,0.4,1.6,5.6,0.4,0,6.5,0.4,0,6.5,-0.4,-1.6,5.6,0.4,-1.6,5.6,0.4,0,6.5,-0.4,-1.6,5.6,-0.4,-1.6,5.6,0.4,-1.6,5.6,-0.4,0,2,0.4,0,2,0.4,-1.6,5.6,-0.4,0,2,-0.4,0,2,0.4,0,2,-0.4,1.6,5.6,0.4,1.6,5.6,0.4,0,2,-0.4,1.6,5.6,-0.4,1.6,5.6,0.4,1.6,5.6,-0.4,0,6.5,0.4,0,6.5,0.4,1.6,5.6,-0.4,0,6.5,-0.4,0,6.5,-0.4,1.6,5.6,-0.4,0,2,-0.4,0,6.5,-0.4,0,2,-0.4,-1.6,5.6,-0.4,0,6.7,1.2,-1.7,4.3,0.6,0,-2.5,1.2,0,-2.5,1.2,-1.7,4.3,0.6,-0.8,-2.5,0.7,0,6.7,1.2,0,-2.5,1.2,1.7,4.3,0.6,1.7,4.3,0.6,0,-2.5,1.2,0.8,-2.5,0.7,0,-2.5,1.2,-0.8,-2.5,0.7,0.8,-2.5,0.7,-0.8,-2.5,0.7,-1.8,-14.3,1.2,0.8,-2.5,0.7,0.8,-2.5,0.7,-1.8,-14.3,1.2,2.4,-14.3,1.2,-1.8,-14.3,1.2,0,-17,0,2.4,-14.3,1.2,0,6.7,1.2,0,6.7,-1,-1.7,4.3,0.6,-1.7,4.3,0.6,0,6.7,-1,-1.7,4.3,-0.8,-1.7,4.3,0.6,-1.7,4.3,-0.8,-0.8,-2.5,0.7,-0.8,-2.5,0.7,-1.7,4.3,-0.8,-0.8,-2.5,-0.8,-0.8,-2.5,0.7,-0.8,-2.5,-0.8,-1.8,-14.3,1.2,-1.8,-14.3,1.2,-0.8,-2.5,-0.8,-1.6,-14.3,-1.2,-1.8,-14.3,1.2,-1.6,-14.3,-1.2,0,-17,0,0,-17,0,2.2,-14.3,-1,2.4,-14.3,1.2,-1.6,-14.3,-1.2,2.2,-14.3,-1,0,-17,0,2.4,-14.3,1.2,2.2,-14.3,-1,0.8,-2.5,0.7,0.8,-2.5,0.7,2.2,-14.3,-1,0.8,-2.5,-0.8,0.8,-2.5,0.7,0.8,-2.5,-0.8,1.7,4.3,0.6,1.7,4.3,0.6,0.8,-2.5,-0.8,1.7,4.3,-0.8,1.7,4.3,0.6,1.7,4.3,-0.8,0,6.7,1.2,0,6.7,1.2,1.7,4.3,-0.8,0,6.7,-1,0,6.7,-1,1.7,4.3,-0.8,0,-2.5,-1,0,-2.5,-1,1.7,4.3,-0.8,0.8,-2.5,-0.8,0,6.7,-1,0,-2.5,-1,-1.7,4.3,-0.8,-1.7,4.3,-0.8,0,-2.5,-1,-0.8,-2.5,-0.8,2.2,-14.3,-1,-1.6,-14.3,-1.2,0.8,-2.5,-0.8,0.8,-2.5,-0.8,-1.6,-14.3,-1.2,-0.8,-2.5,-0.8
  ];

  var colors = [
    0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.3843137254901961,0.33725490196078434,0.30196078431372547,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.13725490196078433,0.07058823529411765,0.047058823529411764,0.13725490196078433,0.07058823529411765,0.047058823529411764,0.13725490196078433,0.07058823529411765,0.047058823529411764,0.13725490196078433,0.07058823529411765,0.047058823529411764,0.13725490196078433,0.07058823529411765,0.047058823529411764,0.13725490196078433,0.07058823529411765,0.047058823529411764,0.13725490196078433,0.07058823529411765,0.047058823529411764,0.13725490196078433,0.07058823529411765,0.047058823529411764,0.13725490196078433,0.07058823529411765,0.047058823529411764,0.9882352941176471,0.8,0.403921568627451,0.9882352941176471,0.8,0.403921568627451,0.9882352941176471,0.8,0.403921568627451,0.9019607843137255,0.6313725490196078,0.3568627450980392,0.9019607843137255,0.6313725490196078,0.3568627450980392,0.9019607843137255,0.6313725490196078,0.3568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.8823529411764706,0.7058823529411765,0.3137254901960784,0.8823529411764706,0.7058823529411765,0.3137254901960784,0.8823529411764706,0.7058823529411765,0.3137254901960784,0.8823529411764706,0.7058823529411765,0.3137254901960784,0.8823529411764706,0.7058823529411765,0.3137254901960784,0.8823529411764706,0.7058823529411765,0.3137254901960784,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.19607843137254902,0.1450980392156863,0.12549019607843137,0.11764705882352941,0.043137254901960784,0.01568627450980392,0.11764705882352941,0.043137254901960784,0.01568627450980392,0.11764705882352941,0.043137254901960784,0.01568627450980392,0.11764705882352941,0.043137254901960784,0.01568627450980392,0.11764705882352941,0.043137254901960784,0.01568627450980392,0.11764705882352941,0.043137254901960784,0.01568627450980392,0.6470588235294118,0.40784313725490196,0.13725490196078433,0.6470588235294118,0.40784313725490196,0.13725490196078433,0.6470588235294118,0.40784313725490196,0.13725490196078433,0.6470588235294118,0.40784313725490196,0.13725490196078433,0.6470588235294118,0.40784313725490196,0.13725490196078433,0.6470588235294118,0.40784313725490196,0.13725490196078433,0.11372549019607843,0.03137254901960784,0,0.11372549019607843,0.03137254901960784,0,0.11372549019607843,0.03137254901960784,0,0.11372549019607843,0.03137254901960784,0,0.11372549019607843,0.03137254901960784,0,0.11372549019607843,0.03137254901960784,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.09411764705882353,0.00392156862745098,0,0.8549019607843137,0.5882352941176471,0.3137254901960784,0.8549019607843137,0.5882352941176471,0.3137254901960784,0.8549019607843137,0.5882352941176471,0.3137254901960784,0.9058823529411765,0.7254901960784313,0.3333333333333333,0.9058823529411765,0.7254901960784313,0.3333333333333333,0.9058823529411765,0.7254901960784313,0.3333333333333333,
  ];

  var material = new THREE.MeshPhongMaterial({
    side: THREE.DoubleSide,
    vertexColors: THREE.VertexColors,
    shininess: 10,
    // specular: 0x50473b,
  });
  var geometry = new THREE.BufferGeometry();
  geometry.addAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
  geometry.addAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );


  THREE.Mesh.call(this, geometry, material);
}
ButterflyBody.prototype = Object.create(THREE.Mesh.prototype);
ButterflyBody.prototype.constructor = ButterflyBody;


function ButterflyWings(flipX) {

  var positions = [
    -0.1,0.1,0,-0.8,3.1,0,-17.3,-5.8,0,-0.8,3.1,0,-14.6,13.5,0,-15,12.2,0,-0.8,3.1,0,-15,12.2,0,-19.8,5.2,0,-0.8,3.1,0,-19.8,5.2,0,-17.3,-5.8,0,-14.6,13.5,0,-32.9,12.6,0,-15,12.2,0,-15,12.2,0,-32.9,12.6,0,-19.8,5.2,0,-19.8,5.2,0,-32.9,12.6,0,-17.3,-5.8,0,-0.1,0,0,-13.1,-5.3,0,-8.9,-12.2,0,-0.1,0,0.1,-13.1,-5.3,0.1,-5.8,-5.8,0.1,-6.3,-8.7,0.1,-7.4,-8.6,0.1,-7,-9.6,0.1,-0.1,0,0,-8.9,-12.2,0,-2.3,-13.5,0
  ];

  var colors = [
    0.18823529411764706,0.12549019607843137,0.11372549019607843,0.18823529411764706,0.12549019607843137,0.11372549019607843,0.18823529411764706,0.12549019607843137,0.11372549019607843,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.984313725490196,0.5686274509803921,0.23529411764705882,0.984313725490196,0.5686274509803921,0.23529411764705882,0.984313725490196,0.5686274509803921,0.23529411764705882,0.25882352941176473,0.23529411764705882,0.19607843137254902,0.25882352941176473,0.23529411764705882,0.19607843137254902,0.25882352941176473,0.23529411764705882,0.19607843137254902,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.8941176470588236,0.43137254901960786,0.2235294117647059,0.8941176470588236,0.43137254901960786,0.2235294117647059,0.8941176470588236,0.43137254901960786,0.2235294117647059,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.23137254901960785,0.17647058823529413,0.1568627450980392,0.9333333333333333,0.5215686274509804,0.2823529411764706,0.9333333333333333,0.5215686274509804,0.2823529411764706,0.9333333333333333,0.5215686274509804,0.2823529411764706,0.9372549019607843,0.7294117647058823,0.4196078431372549,0.9372549019607843,0.7294117647058823,0.4196078431372549,0.9372549019607843,0.7294117647058823,0.4196078431372549,0.13725490196078433,0.14901960784313725,0.14901960784313725,0.13725490196078433,0.14901960784313725,0.14901960784313725,0.13725490196078433,0.14901960784313725,0.14901960784313725,0.792156862745098,0.396078431372549,0.19607843137254902,0.792156862745098,0.396078431372549,0.19607843137254902,0.792156862745098,0.396078431372549,0.19607843137254902
  ];

  var material = new THREE.MeshPhongMaterial({
    side: THREE.DoubleSide,
    vertexColors: THREE.VertexColors,
    shininess: 10,
    // specular: 0x50473b,
  });
  var geometry = new THREE.BufferGeometry();
  geometry.addAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
  geometry.addAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );

  if (flipX) geometry.scale(-1, 1, 1);

  THREE.Mesh.call(this, geometry, material);
}

ButterflyWings.prototype = Object.create(THREE.Mesh.prototype);
ButterflyWings.prototype.constructor = ButterflyWings;



function ButterflyTentacle(flipX) {

  var positions = [
		-0.4, 6.2, 0.0,
		-8.7, 15.0, 3.6,
		-0.8, 5.8, 0.2,

		-0.8, 5.8, 0.2,
		-8.7, 15.0, 3.6,
		 -0.6, 6.0, -0.2,

		 -0.6, 6.0, -0.2,
		-8.7, 15.0, 3.6,
		-0.4, 6.2, 0.0,
  ];

  var colors = [
    0.15294117647058825,0.13725490196078433,0.12941176470588237,0.15294117647058825,0.13725490196078433,0.12941176470588237,0.15294117647058825,0.13725490196078433,0.12941176470588237,0.11372549019607843,0.09803921568627451,0.09019607843137255,0.11372549019607843,0.09803921568627451,0.09019607843137255,0.11372549019607843,0.09803921568627451,0.09019607843137255,0.11372549019607843,0.09803921568627451,0.09019607843137255,0.11372549019607843,0.09803921568627451,0.09019607843137255,0.11372549019607843,0.09803921568627451,0.09019607843137255
  ];

  var material = new THREE.MeshPhongMaterial({
    side: THREE.DoubleSide,
    vertexColors: THREE.VertexColors,
    shininess: 10,
    // specular: 0x50473b,
  });
  var geometry = new THREE.BufferGeometry();
  geometry.addAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
  geometry.addAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );

  if (flipX) geometry.scale(-1, 1, 1);

  THREE.Mesh.call(this, geometry, material);
}

ButterflyTentacle.prototype = Object.create(THREE.Mesh.prototype);
ButterflyTentacle.prototype.constructor = ButterflyTentacle;
